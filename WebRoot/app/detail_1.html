<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!--   <title>我的生活</title> -->
<meta name="viewport" content="initial-scale=1, maximum-scale=1">
<!-- <link rel="shortcut icon" href="/favicon.ico"> -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="stylesheet"
	href="http://g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
<link rel="stylesheet"
	href="http://g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css">
<body>

	<div class="content">

		<div class="card facebook-card">
			<div class="card-header no-border">
				<div class="facebook-avatar">
					<img
						src="http://gqianniu.alicdn.com/bao/uploaded/i4//tfscom/i3/TB10LfcHFXXXXXKXpXXXXXXXXXX_!!0-item_pic.jpg_250x250q60.jpg"
						width="34" height="34">
				</div>
				<div class="facebook-name" id="info_user_name"></div>
				<div class="facebook-date" id="info_user_description"></div>
			</div>

			<div class="card-footer no-border">
				<a href="#" class="link">赞</a> <a href="#" class="link"></a> <a
					href="#" class="link">分享</a>
			</div>
		</div>

		<div class="card demo-card-header-pic">
			<div valign="bottom"
				class="card-header color-white no-border no-padding">
				<img class='card-cover'
					src="//gqianniu.alicdn.com/bao/uploaded/i4//tfscom/i3/TB10LfcHFXXXXXKXpXXXXXXXXXX_!!0-item_pic.jpg_250x250q60.jpg"
					alt="">
			</div>
			<div class="card-content">
				<div class="card-content-inner">
					<p class="color-gray" id="info_time"></p>
					<p id="info_content"></p>
					<span id="info_img_content">
				</div>

			</div>
			<div class="card-footer">
				<a href="#" class="link" id="info_locat_tag">揭阳科技馆</a>

			</div>
		</div>

		<div class="card">
			<div class="card-header">评论:</div>
			<div class="card-content">
				<div class="card-content-inner" id="info_no_comment">当前暂无人评论</div>
				<div class="list-block media-list">
					<ul id="info_comment">
						
					<!-- 这里放置评论 -->
					</ul>
				</div>
			</div>

		</div>


	</div>

	</div>
	<script type='text/javascript'
		src='http://g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
	<script type='text/javascript'
		src='http://g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
	<script type='text/javascript'
		src='http://g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js'
		charset='utf-8'></script>
	<script>
		$.init();
	</script>
	<script src="js/JsBridge2.js" type="text/javascript"></script>
	<script type="text/javascript">
		var topicid = 0;
		//var last = 0;
		//var items = null;
		var tempComment = null;
		registerBridge(MyInit, register);
		function MyInit(message, responseCallback) {
			topicid = message;
			showLog("带过来的id是：" + message);
			var data = {
				"title" : "话题详情2",
				"right" : {
					"icon" : "",
					"description" : "描述",
					"callback" : "onRightBtnClick"
				}
			};
			getTopicDetail(message);
			responseCallback(data);
		}
		function register(bridge) {
		}

		//根据id获取topic
		function getTopicDetail(topic_id) {
			var pars = "url=android/topic_one&topicId=" + topic_id;
			sendGetRequest(pars, function(responseData) {
				var result = eval("(" + responseData + ")");
				showLog("result=" + responseData);
				adapterTopicDetail(result.infos);
				getTopicComment();
				loadComplete();
			});
		}

		//获取评论
		function getTopicComment() {

			var pars = "url=android/topic_commentList&topicId=" + topicid;
			sendGetRequest(pars, function(responseData) {
				showLog("获取评论的结果是：responseData:" + responseData);
				var result = eval("(" + responseData + ")");
				$("#search").attr('placeholder', '请输入留言');
				adapterComment(result.infos);
			});
		}
		//将从网络获取过来的detail适配到ui里面
		function adapterTopicDetail(infos) {
			//$("#info_head_parent").attr("data-me", JSON.stringify(infos.userCommonInfo));
			$("#info_user_name").html(infos.userCommonInfo.name);
			$("#info_user_description").html("假装是个人签名");
			$("#info_content").html(infos.content);
			$("#info_time").html(infos.time);
			if(infos.picss!=null){
				var html = '';
				
				for(var i=0;i<infos.picss.length;i++){
					html+= '<img src="'+infos.picss[i]+'" height="60" width="60"> </span>';
				}
				$("#info_img_content").prepend(html);
				
			}
		}

		//回复按钮被点击的时候
		function onReplyClick() {
			getUser(submitContent);
		}
		var last = 0;
		//将评论适配到ui里面
		function adapterComment(comments) {
			var html = '';
			var number = comments.length;
			if(number!=0){
				$('#info_no_comment').hide();
			}
			for ( var i = 1 + last; i <= number + last; i++) {
				html += '<li class="item-content"><div class="item-media">'
						+ '<img src="http://gqianniu.alicdn.com/bao/uploaded/i4//tfscom/i3/TB10LfcHFXXXXXKXpXXXXXXXXXX_!!0-item_pic.jpg_250x250q60.jpg" width="44">'
						+ '</div><div class="item-inner"><div class="item-title-row"><div class="item-title">'+comments[i-last-1].from_nick+'</div>'
						+ '</div><div class="item-subtitle">'+getText(comments[i-last-1])+'</div></div></li>';
			}
			$("#info_comment").append(html);
		}
		
		function getText(item){
			var result = "";
            if (item.to_uid != 0) {
                result = "回复@" + item.to_unick + ":";
            }
            result += item.content;
            //console.log(result);
            return result;
		}
	</script>
</body>
</html>